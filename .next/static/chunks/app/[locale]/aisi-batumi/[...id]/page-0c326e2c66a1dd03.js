(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[619],{6147:(e,a,l)=>{"use strict";l.r(a),l.d(a,{default:()=>y});var t=l(5155),r=l(2115),s=l(9373),i=l(5578),n=l(5234),o=l(6115),d=l(5695),c=l(4341),m=l(2355),u=l(285),h=l(9446),f=l(6812);let g={desktop:{width:1440,height:671},mobile:{width:1856,height:3820}},x={desktop:{width:1440,height:671},mobile:{width:1856,height:3820}};var v=l(7059);let p=r.memo(c.w),b=r.memo(o.f),j=e=>{let{message:a="Loading..."}=e;return(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-full w-full",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-600 mb-4"}),(0,t.jsx)("p",{className:"text-gray-600 text-sm",children:a})]})};function y(){let[e,a]=(0,r.useState)(null),[l,o]=(0,r.useState)(void 0),[c,y]=(0,r.useState)(!1),N=(0,d.useParams)(),w=(0,d.useRouter)(),{buildingId:_,floorPlanId:k,floorId:I}=(0,r.useCallback)(()=>{let e=Array.isArray(N.id)?N.id:[N.id];return{buildingId:e[0]||"",floorPlanId:e[1]||"",floorId:e[2]||""}},[N.id])(),C=!!(_&&k&&I),{data:F=[],isLoading:q,error:A}=(0,s.I)({queryKey:["floorPlanList",_],queryFn:async()=>{if(!_)return[];try{return await i.$.getList(_)}catch(e){return console.error("Error fetching floor plans:",e),[]}},staleTime:3e5,gcTime:18e5,retry:2,enabled:!!_}),L=(0,r.useMemo)(()=>F&&0!==F.length&&F.find(e=>e.id.toString()===k)||null,[F,k]),{data:P,isLoading:S,error:E}=(0,s.I)({queryKey:["apartments",_,k,I],queryFn:async()=>{if(!C)throw Error("Missing required IDs");return i.$.getApartments(_,k,I)},staleTime:3e5,gcTime:18e5,retry:2,enabled:C}),T=q||S,D=A||E||!T&&(!F.length||!L),{isMobile:M,apartmentAreas:$}=(0,n.c)(P),z=(0,r.useCallback)((e,a)=>{var l,t,r,s,i,n,d,c,m;let u=null==P?void 0:null===(i=P.apartments)||void 0===i?void 0:null===(s=i[0])||void 0===s?void 0:null===(r=s.apartments)||void 0===r?void 0:null===(t=r[0])||void 0===t?void 0:null===(l=t.apartments)||void 0===l?void 0:l.find(e=>Number(e.flat_number)===a);u&&(o({id:parseInt(u.flat_id),number:u.flat_number,area:parseFloat(u.square_meters)||0,status:u.status,floor:(null==P?void 0:null===(m=P.apartments)||void 0===m?void 0:null===(c=m[0])||void 0===c?void 0:null===(d=c.apartments)||void 0===d?void 0:null===(n=d[0])||void 0===n?void 0:n.floor)||1,price:u.sqm_price?parseFloat(u.sqm_price)*parseFloat(u.square_meters):void 0,images:u.images||[]}),y(!0))},[P]),B=(0,r.useCallback)(()=>{w.back()},[w]),O=(0,r.useMemo)(()=>L?M?"http://localhost:3001/".concat(L.mobile_image):"http://localhost:3001/".concat(L.desktop_image):"/placeholder.svg",[L,M]),R=(0,r.useCallback)(l=>{let{scaleFactorX:r,scaleFactorY:s}=l;return(0,t.jsx)(t.Fragment,{children:$.map(l=>(0,t.jsx)(b,{flatId:l.flatId,flatNumber:l.flatNumber,status:l.status,coords:l.coords,hoveredApartment:e,setHoveredApartment:a,onApartmentClick:z,scaleFactorX:r,scaleFactorY:s},l.flatId))})},[$,e,z]);return(0,t.jsx)("main",{className:"relative ".concat(M?"min-h-screen":"h-screen"," w-full bg-gray-50 ").concat(M?"overflow-y-auto":"overflow-hidden"," z-50"),children:T?(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-50",children:(0,t.jsx)(j,{message:"Loading floor plan data..."})}):D?(0,t.jsx)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gray-50",children:(0,t.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-red-700 mb-2",children:"Unable to Load Data"}),(0,t.jsx)("p",{className:"text-gray-700 mb-4",children:"We couldn't load the floor plan data. Please try again later or contact support."}),(0,t.jsx)(u.$,{onClick:B,className:"bg-red-600 hover:bg-red-700 text-white",children:"Go Back"})]})}):(0,t.jsxs)("div",{className:"flex flex-col ".concat(M?"":"h-full"),children:[!T&&(0,t.jsxs)("div",{className:"bg-white flex justify-start items-center rounded-xl shadow-lg py-5 px-4 md:px-10",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsxs)(u.$,{variant:"outline",size:"sm",onClick:B,className:"flex items-center gap-1",children:[(0,t.jsx)(m.A,{size:16}),(0,t.jsx)("span",{className:"hidden md:inline",children:"Back"})]})}),(0,t.jsx)("div",{className:"mx-4 flex items-center gap-3",children:(0,t.jsx)(v.W,{currentFloor:parseInt(I),floorRangeStart:null==L?void 0:L.floor_range_start,floorRangeEnd:null==L?void 0:L.floor_range_end,buildingId:_,floorPlanId:k,route:"aisi-batumi"})}),(0,t.jsx)(h.A,{})]}),(0,t.jsx)("div",{className:"".concat(M?"mt-2":"flex-1 overflow-hidden min-h-0"),children:(0,t.jsx)(p,{imageSrc:O||"/placeholder.svg",altText:"".concat((null==L?void 0:L.name)||"Building"," - Floor ").concat(I," Plan"),originalDimensions:g,maxDimensions:x,isMobile:M,priority:!0,children:R},"floor-".concat(I,"-plan-").concat(k))}),(0,t.jsx)(f.S,{isOpen:c,onClose:()=>{y(!1)},apartment:l||null})]})})}},8393:(e,a,l)=>{Promise.resolve().then(l.bind(l,6147))}},e=>{var a=a=>e(e.s=a);e.O(0,[914,766,794,676,874,662,386,453,75,917,575,350,441,684,358],()=>a(8393)),_N_E=e.O()}]);