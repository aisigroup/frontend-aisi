(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[713],{2008:(e,a,l)=>{"use strict";l.r(a),l.d(a,{default:()=>y});var r=l(5155),t=l(2115),s=l(9373),i=l(5578),n=l(5234),o=l(6115),d=l(5695);let c={desktop:{width:1440,height:671},mobile:{width:1856,height:3820}},m={desktop:{width:1440,height:671},mobile:{width:1856,height:3820}};var u=l(4341),h=l(2355),f=l(285),g=l(9446),p=l(6812),x=l(7059);let v=t.memo(u.w),b=t.memo(o.f),j=e=>{let{message:a="Loading..."}=e;return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full w-full",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-600 mb-4"}),(0,r.jsx)("p",{className:"text-gray-600 text-sm",children:a})]})};function y(){let[e,a]=(0,t.useState)(null),[l,o]=(0,t.useState)(void 0),[u,y]=(0,t.useState)(!1),N=(0,d.useParams)(),w=(0,d.useRouter)(),{buildingId:_,floorPlanId:k,floorId:I}=(0,t.useCallback)(()=>{let e=Array.isArray(N.id)?N.id:[N.id];return{buildingId:e[0]||"",floorPlanId:e[1]||"",floorId:e[2]||""}},[N.id])(),C=!!(_&&k&&I),{data:F=[],isLoading:q,error:A}=(0,s.I)({queryKey:["floorPlanList",_],queryFn:async()=>{if(!_)return[];try{return await i.$.getList(_)}catch(e){return console.error("Error fetching floor plans:",e),[]}},staleTime:3e5,gcTime:18e5,retry:2,enabled:!!_}),L=(0,t.useMemo)(()=>F&&0!==F.length&&F.find(e=>e.id.toString()===k)||null,[F,k]),{data:P,isLoading:S,error:E}=(0,s.I)({queryKey:["apartments",_,k,I],queryFn:async()=>{if(!C)throw Error("Missing required IDs");return i.$.getApartments(_,k,I)},staleTime:3e5,gcTime:18e5,retry:2,enabled:C}),T=q||S,z=A||E||!T&&(!F.length||!L),{isMobile:D,apartmentAreas:M}=(0,n.c)(P),$=(0,t.useCallback)((e,a)=>{var l,r,t,s,i,n,d,c,m;let u=null==P?void 0:null===(i=P.apartments)||void 0===i?void 0:null===(s=i[0])||void 0===s?void 0:null===(t=s.apartments)||void 0===t?void 0:null===(r=t[0])||void 0===r?void 0:null===(l=r.apartments)||void 0===l?void 0:l.find(e=>Number(e.flat_number)===a);u&&(o({id:parseInt(u.flat_id),number:u.flat_number,area:parseFloat(u.square_meters)||0,status:u.status,floor:(null==P?void 0:null===(m=P.apartments)||void 0===m?void 0:null===(c=m[0])||void 0===c?void 0:null===(d=c.apartments)||void 0===d?void 0:null===(n=d[0])||void 0===n?void 0:n.floor)||1,price:u.sqm_price?parseFloat(u.sqm_price)*parseFloat(u.square_meters):void 0,images:u.images||[]}),y(!0))},[P]),B=(0,t.useCallback)(()=>{w.back()},[w]),O=(0,t.useMemo)(()=>L?D?"".concat("https://api.aisigroup.ge").concat(L.mobile_image):"".concat("https://api.aisigroup.ge").concat(L.desktop_image):"/placeholder.svg",[L,D]),R=(0,t.useCallback)(l=>{let{scaleFactorX:t,scaleFactorY:s}=l;return(0,r.jsx)(r.Fragment,{children:M.map(l=>(0,r.jsx)(b,{flatId:l.flatId,flatNumber:l.flatNumber,status:l.status,coords:l.coords,hoveredApartment:e,setHoveredApartment:a,onApartmentClick:$,scaleFactorX:t,scaleFactorY:s},l.flatId))})},[M,e,$]);return(0,r.jsx)("main",{className:"relative ".concat(D?"min-h-screen":"h-screen"," w-full bg-gray-50 ").concat(D?"overflow-y-auto":"overflow-hidden"," z-50"),children:T?(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-50",children:(0,r.jsx)(j,{message:"Loading floor plan data..."})}):z?(0,r.jsx)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-red-700 mb-2",children:"Unable to Load Data"}),(0,r.jsx)("p",{className:"text-gray-700 mb-4",children:"We couldn't load the floor plan data. Please try again later or contact support."}),(0,r.jsx)(f.$,{onClick:B,className:"bg-red-600 hover:bg-red-700 text-white",children:"Go Back"})]})}):(0,r.jsxs)("div",{className:"flex flex-col ".concat(D?"":"h-full"),children:[!T&&(0,r.jsxs)("div",{className:"bg-white flex justify-start items-center rounded-xl shadow-lg py-5 px-4 md:px-10",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsxs)(f.$,{variant:"outline",size:"sm",onClick:B,className:"flex items-center gap-1",children:[(0,r.jsx)(h.A,{size:16}),(0,r.jsx)("span",{className:"hidden md:inline",children:"Back"})]})}),(0,r.jsx)("div",{className:"mx-4 flex items-center gap-3",children:(0,r.jsx)(x.W,{currentFloor:parseInt(I),floorRangeStart:null==L?void 0:L.floor_range_start,floorRangeEnd:null==L?void 0:L.floor_range_end,buildingId:_,floorPlanId:k,route:"aisi-goderdzi"})}),(0,r.jsx)(g.A,{})]}),(0,r.jsx)("div",{className:"".concat(D?"mt-2":"flex-1 overflow-hidden min-h-0"),children:(0,r.jsx)(v,{imageSrc:O||"/placeholder.svg",altText:"".concat((null==L?void 0:L.name)||"Building"," - Floor ").concat(I," Plan"),originalDimensions:c,maxDimensions:m,isMobile:D,priority:!0,children:R},"floor-".concat(I,"-plan-").concat(k))}),(0,r.jsx)(p.S,{isOpen:u,onClose:()=>{y(!1)},apartment:l||null})]})})}},6444:(e,a,l)=>{Promise.resolve().then(l.bind(l,2008))}},e=>{var a=a=>e(e.s=a);e.O(0,[914,766,794,676,874,662,386,453,75,917,575,350,441,684,358],()=>a(6444)),_N_E=e.O()}]);