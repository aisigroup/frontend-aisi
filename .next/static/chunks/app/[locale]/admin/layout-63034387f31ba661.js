(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[490],{285:(e,t,r)=>{"use strict";r.d(t,{$:()=>d});var a=r(5155),n=r(2115),s=r(9708),i=r(2085),o=r(9434);let l=(0,i.F)("inline-flex items-center cursor-pointer justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow ",destructive:"bg-white border-[red] border text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),d=n.forwardRef((e,t)=>{let{className:r,variant:n,size:i,asChild:d=!1,...c}=e,u=d?s.DX:"button";return(0,a.jsx)(u,{className:(0,o.cn)(l({variant:n,size:i,className:r})),ref:t,...c})});d.displayName="Button"},768:(e,t,r)=>{"use strict";r.d(t,{S:()=>a});let a=r(3464).A.create({baseURL:"https://api.aisigroup.ge/api",withCredentials:!0,headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e,e=>{var t,r,a,n;return console.error("❌ API Error:",null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.status,null==e?void 0:null===(r=e.response)||void 0===r?void 0:r.data),((null===(a=e.response)||void 0===a?void 0:a.status)===401||(null===(n=e.response)||void 0===n?void 0:n.status)===403)&&(localStorage.removeItem("token"),window.location.pathname.includes("/signin")||(window.location.href="/signin")),Promise.reject(e)})},2012:(e,t,r)=>{"use strict";r.d(t,{default:()=>k});var a=r(5155),n=r(4165),s=r(285),i=r(2523),o=r(5365),l=r(4631),d=r(4616),c=r(8136),u=r(2525),g=r(6715),f=r(9373),m=r(5041),p=r(768);let v={post:async e=>(await p.S.post("/add_building",e)).data,get:async()=>(await p.S.get("/buildings")).data,delete:async e=>(await p.S.delete("/delete_building/".concat(e))).data};var h=r(2115),x=r(6671),b=r(9335),y=r(6874),w=r.n(y),j=r(5695);function k(){let{logout:e}=(0,b.A)(),t=(0,g.jE)(),r=(0,j.usePathname)(),[p,y]=(0,h.useState)(""),[k,N]=(0,h.useState)(""),[S,A]=(0,h.useState)(!1),[C,I]=(0,h.useState)(""),[E,z]=(0,h.useState)(null),[_,F]=(0,h.useState)(null),{data:R=[],isLoading:B}=(0,f.I)({queryKey:["buildings"],queryFn:async()=>(await v.get()).data,staleTime:3e4,gcTime:3e5,retry:1,refetchOnWindowFocus:!0,refetchOnMount:!0}),P=(0,h.useCallback)(()=>{t.prefetchQuery({queryKey:["buildings"],queryFn:async()=>(await v.get()).data,staleTime:3e4})},[t]),D=e=>"Adminuser111"===e,L=(0,m.n)({mutationFn:async()=>{if(!p.trim())throw Error("Building name cannot be empty");return(await v.post({name:p})).data},onSuccess:e=>{t.setQueryData(["buildings"],function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[...t,e]}),t.invalidateQueries({queryKey:["buildings"]}),x.oR.success("Building added successfully"),A(!1),y(""),N(""),I("")},onError:e=>{console.error("Failed to add building:",e),x.oR.error(e instanceof Error?e.message:"Failed to add building")}}),U=(0,m.n)({mutationFn:async e=>(await v.delete(e),e),onSuccess:e=>{t.setQueryData(["buildings"],function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter(t=>t.id!==e)}),t.invalidateQueries({queryKey:["buildings"]}),x.oR.success("Building deleted successfully"),A(!1),N(""),I("")},onError:e=>{console.error("Failed to delete building:",e),x.oR.error("Failed to delete building")}}),q=e=>{A(!0),z("delete"),F(e),I(""),N("")},O=()=>{if(!D(k)){I("Incorrect admin password. Please try again.");return}"add"===E?L.mutate():"delete"===E&&_&&U.mutate(_)},M=e=>null==r?void 0:r.includes("/admin/building/".concat(e.id));return B?(0,a.jsx)("div",{className:"flex justify-center items-center w-64",children:(0,a.jsx)(l.A,{className:"animate-spin"})}):(0,a.jsxs)("div",{className:"flex h-[90vh] fixed mt-24",onMouseEnter:()=>{P()},children:[(0,a.jsxs)("div",{className:"w-64 bg-gray-100 border-r p-4 flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Buildings"}),(0,a.jsx)(s.$,{variant:"outline",size:"icon",onClick:()=>{A(!0),z("add"),I(""),N("")},className:"hover:bg-gray-200",children:(0,a.jsx)(d.A,{className:"h-4 w-4"})})]}),(0,a.jsx)("div",{className:"flex-grow",children:0===R.length?(0,a.jsx)("p",{className:"text-center text-gray-500",children:"No buildings"}):(0,a.jsx)("div",{className:"space-y-2",children:R.map(e=>(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-3 rounded cursor-pointer ".concat(M(e)?"bg-blue-100":"hover:bg-gray-200"),children:[(0,a.jsx)(w(),{href:"/admin/building/".concat(e.id),className:"w-full",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(c.A,{className:"h-5 w-5 text-gray-500"}),(0,a.jsx)("span",{children:e.name})]})}),(0,a.jsx)(s.$,{variant:"ghost",size:"icon",disabled:U.isPending,onClick:t=>{t.stopPropagation(),q(e.id)},children:(0,a.jsx)(u.A,{className:"h-4 w-4 text-red-500"})})]}),(0,a.jsx)("div",{className:"border-t border-gray-300 my-2"})]},e.id))})}),(0,a.jsx)("div",{className:"mt-auto pb-4",children:(0,a.jsx)(s.$,{onClick:e,variant:"outline",className:"w-full",children:"Log out"})})]}),(0,a.jsx)(n.lG,{open:S,onOpenChange:e=>{e||(I(""),N(""),"add"===E&&y("")),A(e)},children:(0,a.jsxs)(n.Cf,{children:[(0,a.jsx)(n.c7,{children:(0,a.jsx)(n.L3,{children:"add"===E?"Add New Building":"Delete Building Confirmation"})}),(0,a.jsxs)("div",{className:"space-y-4",children:[C&&(0,a.jsx)(o.Fc,{variant:"destructive",children:(0,a.jsx)(o.TN,{children:C})}),"add"===E&&(0,a.jsx)(i.p,{placeholder:"Enter Building Name",value:p,onChange:e=>y(e.target.value)}),(0,a.jsx)(i.p,{type:"password",placeholder:"Enter Admin Password",value:k,onChange:e=>N(e.target.value),onKeyDown:e=>{"Enter"===e.key&&O()}}),(0,a.jsx)(s.$,{onClick:O,disabled:!k.trim()||"add"===E&&!p.trim(),children:"Confirm"})]})]})})]})}},2523:(e,t,r)=>{"use strict";r.d(t,{p:()=>s});var a=r(5155);r(2115);var n=r(9434);function s(e){let{className:t,type:r,...s}=e;return(0,a.jsx)("input",{type:r,"data-slot":"input",className:(0,n.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...s})}},4165:(e,t,r)=>{"use strict";r.d(t,{Cf:()=>u,Es:()=>f,L3:()=>m,c7:()=>g,lG:()=>o,rr:()=>p,zM:()=>l});var a=r(5155);r(2115);var n=r(5776),s=r(4416),i=r(9434);function o(e){let{...t}=e;return(0,a.jsx)(n.bL,{"data-slot":"dialog",...t})}function l(e){let{...t}=e;return(0,a.jsx)(n.l9,{"data-slot":"dialog-trigger",...t})}function d(e){let{...t}=e;return(0,a.jsx)(n.ZL,{"data-slot":"dialog-portal",...t})}function c(e){let{className:t,...r}=e;return(0,a.jsx)(n.hJ,{"data-slot":"dialog-overlay",className:(0,i.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...r})}function u(e){let{className:t,children:r,...o}=e;return(0,a.jsxs)(d,{"data-slot":"dialog-portal",children:[(0,a.jsx)(c,{}),(0,a.jsxs)(n.UC,{"data-slot":"dialog-content",className:(0,i.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...o,children:[r,(0,a.jsxs)(n.bm,{className:"ring-offset-background cursor-pointer focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,a.jsx)(s.A,{}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function g(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"dialog-header",className:(0,i.cn)("flex flex-col gap-2 text-center sm:text-left",t),...r})}function f(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"dialog-footer",className:(0,i.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...r})}function m(e){let{className:t,...r}=e;return(0,a.jsx)(n.hE,{"data-slot":"dialog-title",className:(0,i.cn)("text-lg leading-none font-semibold",t),...r})}function p(e){let{className:t,...r}=e;return(0,a.jsx)(n.VY,{"data-slot":"dialog-description",className:(0,i.cn)("text-muted-foreground text-sm",t),...r})}},4631:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(9946).A)("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]])},5365:(e,t,r)=>{"use strict";r.d(t,{Fc:()=>o,TN:()=>l});var a=r(5155);r(2115);var n=r(2085),s=r(9434);let i=(0,n.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:r,...n}=e;return(0,a.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,s.cn)(i({variant:r}),t),...n})}function l(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"alert-description",className:(0,s.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),...r})}},7383:(e,t,r)=>{"use strict";function a(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)e[a]=r[a]}return e}r.d(t,{A:()=>n});var n=function e(t,r){function n(e,n,s){if("undefined"!=typeof document){"number"==typeof(s=a({},r,s)).expires&&(s.expires=new Date(Date.now()+864e5*s.expires)),s.expires&&(s.expires=s.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var o in s){if(s[o])i+="; "+o,!0!==s[o]&&(i+="="+s[o].split(";")[0])}return document.cookie=e+"="+t.write(n,e)+i}}return Object.create({set:n,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var r=document.cookie?document.cookie.split("; "):[],a={},n=0;n<r.length;n++){var s=r[n].split("="),i=s.slice(1).join("=");try{var o=decodeURIComponent(s[0]);if(a[o]=t.read(i,o),e===o)break}catch(e){}}return e?a[e]:a}},remove:function(e,t){n(e,"",a({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,a({},this.attributes,t))},withConverter:function(t){return e(a({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})},9083:(e,t,r)=>{Promise.resolve().then(r.bind(r,2012))},9335:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,AuthProvider:()=>d});var a=r(5155),n=r(2115),s=r(5695),i=r(7383),o=r(9870);let l=(0,n.createContext)(null),d=e=>{let{children:t}=e,[r,d]=(0,n.useState)(null),[c,u]=(0,n.useState)(!1),[g,f]=(0,n.useState)(!0),m=(0,s.useRouter)(),p=async()=>{try{let e=i.A.get("token"),t=localStorage.getItem("token");if(!e&&!t){u(!1),d(null),f(!1);return}!e&&t&&i.A.set("token",t,{secure:!0,sameSite:"none",expires:1});let r=await o.R.checkAuthStatus();r.user?(d(r.user),u(!0),t!==e&&e&&localStorage.setItem("token",e)):(d(null),u(!1),i.A.remove("token"),localStorage.removeItem("token"))}catch(e){console.error("❌ Auth verification failed:",e),d(null),u(!1),i.A.remove("token"),localStorage.removeItem("token")}finally{f(!1)}},v=async()=>{try{await o.R.signout()}catch(e){console.error("❌ Logout error:",e)}finally{i.A.remove("token",{path:"/",domain:void 0}),localStorage.removeItem("token"),d(null),u(!1),m.push("/")}};return(0,n.useEffect)(()=>{p();let e=setInterval(()=>{c&&p()},3e5);return()=>clearInterval(e)},[]),(0,a.jsx)(l.Provider,{value:{user:r,authenticated:c,isLoading:g,login:e=>{localStorage.setItem("token",e),i.A.set("token",e,{secure:!0,sameSite:"none",expires:1}),p()},logout:v,checkAuth:p},children:t})},c=()=>{let e=(0,n.useContext)(l);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},9434:(e,t,r)=>{"use strict";r.d(t,{cn:()=>s});var a=r(2596),n=r(9688);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.QP)((0,a.$)(t))}},9870:(e,t,r)=>{"use strict";r.d(t,{R:()=>n});var a=r(768);let n={login:async e=>{try{let t=await a.S.post("/signin",e);return t.data.token&&localStorage.setItem("token",t.data.token),t.data}catch(e){throw console.error("❌ Login failed:",e),e}},signup:async e=>{try{return(await a.S.post("/signup",e)).data}catch(e){throw console.error("❌ Signup failed:",e),e}},signout:async()=>{try{let e=await a.S.post("/signout");return localStorage.removeItem("token"),e.data}catch(e){throw console.error("❌ Signout error:",e),localStorage.removeItem("token"),e}},checkAuthStatus:async()=>{try{return(await a.S.get("/status")).data}catch(e){throw console.error("❌ Auth status check failed:",e),e}}}}},e=>{var t=t=>e(e.s=t);e.O(0,[914,794,676,874,662,767,441,684,358],()=>t(9083)),_N_E=e.O()}]);